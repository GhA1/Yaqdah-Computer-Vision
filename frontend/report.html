<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yaqza - Forensic Report</title>
    <link rel="icon" href="logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #09090b; color: #e4e4e7; font-family: 'Segoe UI', sans-serif; }
        .logo-font { font-family: 'Cairo', sans-serif; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(24, 24, 27, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .sidebar-link { transition: all 0.3s; }
        .sidebar-link:hover, .sidebar-link.active { background-color: #064e3b; color: white; border-right: 3px solid #10b981; }
    </style>
</head>
<body class="flex h-screen overflow-hidden bg-zinc-950">

    <aside class="w-64 bg-zinc-900 border-r border-zinc-800 flex flex-col justify-between z-20">
        <div>
            <div class="p-6 flex items-center gap-3 border-b border-zinc-800">
                <img src="logo.png" class="w-10 h-10 object-contain drop-shadow-[0_0_5px_rgba(16,185,129,0.3)]">
                <h1 class="text-3xl font-bold text-white logo-font tracking-wider">يقظة</h1>
            </div>
            <nav class="mt-8 px-4 space-y-2">
                <a href="index.html" class="sidebar-link flex items-center gap-3 p-3 rounded-xl text-zinc-400 hover:text-white">
                    <i data-lucide="layout-dashboard"></i> <span>Dashboard</span>
                </a>
                <a href="cameras.html" class="sidebar-link flex items-center gap-3 p-3 rounded-xl text-zinc-400 hover:text-white">
                    <i data-lucide="cctv"></i> <span>Live Feeds</span>
                </a>
                <a href="logs.html" class="sidebar-link active flex items-center gap-3 p-3 rounded-xl text-zinc-400 hover:text-white">
                    <i data-lucide="file-text"></i> <span>Incident Logs</span>
                </a>
            </nav>
        </div>
        <div class="p-4">
            <div class="bg-zinc-800/50 p-4 rounded-xl border border-zinc-700">
                <div class="flex items-center gap-2 text-emerald-400 mb-2">
                    <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                    <span class="text-xs font-bold">SYSTEM ONLINE</span>
                </div>
                <p class="text-xs text-zinc-500">AI Analyst Active</p>
            </div>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto bg-zinc-950 p-8">
        
        <a href="logs.html" class="mb-6 flex items-center gap-2 text-zinc-400 hover:text-white transition group inline-flex">
            <div class="bg-zinc-800 p-2 rounded-lg group-hover:bg-zinc-700">
                <i data-lucide="arrow-left"></i>
            </div>
            <span>Back to Logs</span>
        </a>

        <div class="bg-zinc-900/80 border border-zinc-800 rounded-3xl p-8 shadow-2xl relative overflow-hidden">
            
            <div class="flex justify-between items-start mb-8 border-b border-zinc-800 pb-6">
                <div>
                    <div class="flex items-center gap-3 mb-2">
                        <span id="report-risk-badge" class="px-3 py-1 rounded text-xs font-bold uppercase tracking-wider shadow-lg">RISK</span>
                        <span class="text-zinc-500 text-sm font-mono" id="report-id">ID: #000</span>
                    </div>
                    <h1 class="text-4xl font-bold text-white mb-1" id="report-title">Event Title</h1>
                    <p class="text-zinc-400 flex items-center gap-2">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        <span id="report-date">Timestamp</span>
                    </p>
                </div>
                <div class="text-right flex flex-col items-end">
                    <div class="flex items-center gap-3">
                         <img src="logo.png" class="w-8 h-8 object-contain">
                         <div class="text-emerald-500 font-bold logo-font text-2xl">يقظة</div>
                    </div>
                     <div class="text-xs text-zinc-600 uppercase tracking-[0.2em] mt-1">Forensic AI Report</div>
                </div>
            </div>

            <div class="mb-10">
                <label class="text-[10px] text-emerald-500 uppercase font-bold tracking-[0.2em] mb-3 block flex items-center gap-2">
                    <i data-lucide="history" class="w-3 h-3"></i> AI Temporal Analysis Timeline (30s Context)
                </label>
                <div class="glass p-2 rounded-2xl border border-zinc-700/50 bg-black overflow-hidden group shadow-inner">
                    <img id="report-image" src="" class="w-full h-auto object-cover rounded-xl" alt="Incident Timeline">
                    <div class="flex justify-between px-4 mt-2 opacity-50 font-mono text-[9px]">
                        <span>-30s</span>
                        <span>-24s</span>
                        <span>-18s</span>
                        <span>-12s</span>
                        <span>-6s</span>
                        <span class="text-red-500 font-bold tracking-widest">DETECTION POINT</span>
                    </div>
                </div>
                <p class="text-[10px] text-zinc-500 mt-2 italic text-center">System analyzed multiple frames to verify behavioral intent and situational risk.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-zinc-800 rounded-xl p-6 border border-zinc-700 shadow-lg">
                        <h4 class="text-zinc-500 text-[10px] uppercase tracking-widest font-bold mb-4">Detected Entities</h4>
                        <div class="flex items-center gap-4">
                            <div class="bg-emerald-900/30 p-4 rounded-xl text-emerald-400">
                                <i data-lucide="users" class="w-8 h-8"></i>
                            </div>
                            <div>
                                <p class="text-3xl font-bold text-white mono-font" id="report-people">0</p>
                                <p class="text-xs text-zinc-500 uppercase font-semibold">Subject Count</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-zinc-800/50 rounded-xl p-5 border border-zinc-700 flex justify-between items-center">
                        <span class="text-xs text-zinc-400">Detection Confidence</span>
                        <span class="text-emerald-500 font-bold mono-font text-lg">99.8%</span>
                    </div>
                </div>

                <div class="lg:col-span-2 space-y-6">
                    
                    <div class="bg-emerald-900/5 rounded-2xl p-7 border border-emerald-900/20 relative">
                        <div class="absolute top-0 left-0 w-1 h-full bg-emerald-600 rounded-l-2xl"></div>
                        <h3 class="text-emerald-400 font-bold mb-6 flex items-center gap-2 text-lg">
                            <i data-lucide="cpu"></i> Comprehensive AI Analysis
                        </h3>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="text-[10px] text-zinc-500 uppercase font-bold tracking-widest mb-2 block">Situation Overview</label>
                                <p id="report-details" class="text-zinc-200 leading-relaxed text-sm tracking-wide"></p>
                            </div>
                            <div>
                                <label class="text-[10px] text-zinc-500 uppercase font-bold tracking-widest mb-2 block">Subject(s) Behavior Profile</label>
                                <div class="bg-black/30 p-4 rounded-xl border border-zinc-800">
                                    <p id="report-desc" class="text-zinc-300 font-mono text-xs leading-relaxed"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-red-950/10 rounded-2xl p-7 border border-red-900/20">
                        <h3 class="text-red-400 font-bold mb-5 flex items-center gap-2 text-sm uppercase tracking-wider">
                            <i data-lucide="shield-alert"></i> Recommended Tactical Response
                        </h3>
                        <ul id="report-actions" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            </ul>
                    </div>

                </div>
            </div>

        </div>
    </main>

    <script>
        lucide.createIcons();

        document.addEventListener('DOMContentLoaded', () => {
            // Retrieve report data from localStorage
            const alertData = localStorage.getItem('current_report');
            if (alertData) {
                const alert = JSON.parse(alertData);
                loadReport(alert);
            } else {
                window.location.href = 'logs.html';
            }
        });

        function loadReport(alert) {
            document.getElementById('report-title').innerText = alert.type.toUpperCase();
            document.getElementById('report-date').innerText = new Date(alert.timestamp).toLocaleString('en-US', { dateStyle: 'full', timeStyle: 'medium' });
            document.getElementById('report-id').innerText = `CASE ID: #${alert.id}`;
            
            // Set the Timeline Filmstrip image
            document.getElementById('report-image').src = `http://localhost:8000/images/${alert.image_path}`;

            try {
                const report = JSON.parse(alert.description);
                
                // Risk Badge Styling
                const riskLevel = (report.risk_level || "Unknown").toUpperCase();
                const badgeEl = document.getElementById('report-risk-badge');
                badgeEl.innerText = `${riskLevel} RISK`;
                
                badgeEl.className = "px-3 py-1 rounded text-xs font-bold uppercase tracking-wider ";
                if(riskLevel.includes("HIGH") || riskLevel.includes("CRIT")) {
                    badgeEl.classList.add("bg-red-600", "text-white", "shadow-red-900/50");
                } else if(riskLevel.includes("MED")) {
                    badgeEl.classList.add("bg-orange-600", "text-white");
                } else {
                    badgeEl.classList.add("bg-emerald-600", "text-white");
                }

                document.getElementById('report-people').innerText = report.person_count || "N/A";
                document.getElementById('report-details').innerText = report.details || "Forensic details currently unavailable.";
                document.getElementById('report-desc').innerText = report.suspect_desc || "No behavioral description logged.";

                // Tactical Actions List
                const actionsList = document.getElementById('report-actions');
                actionsList.innerHTML = '';
                let actions = report.actions;
                if (typeof actions === 'string') actions = [actions];
                
                if (Array.isArray(actions)) {
                    actions.forEach(act => {
                        actionsList.innerHTML += `
                            <li class="flex items-start gap-3 bg-zinc-900/50 p-3 rounded-xl border border-zinc-800 hover:border-red-900/30 transition">
                                <div class="mt-1 text-red-500"><i data-lucide="crosshair" class="w-4 h-4"></i></div>
                                <span class="text-zinc-300 text-xs font-semibold">${act}</span>
                            </li>`;
                    });
                } else {
                     actionsList.innerHTML = `<li class="text-zinc-500 italic">Verify manual SOPs.</li>`;
                }

                lucide.createIcons();

            } catch (e) {
                document.getElementById('report-details').innerText = "Error parsing AI data: " + alert.description;
            }
        }
    </script>
</body>
</html>